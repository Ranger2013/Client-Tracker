// @ts-nocheck
import ManageUser from"../../classes/ManageUser.js";import TokenValidation from"../../classes/TokenValidation.js";export default async function userAuthorization(e){if(!e.includes("/login/")&&!e.includes("/register/"))try{const e=new TokenValidation,t=await e.getUserToken();await e.setToken(t);const r=await e.getToken();return await isUserAccountExpired(r),r}catch(e){const{default:t}=await import("../../utils/error-messages/errorLogs.js");await t("userAuthorizationError","User Authorization Error: ",e);const r="We were unable to validate your credentials.<br>Please try logging in again.";window.location.href=`/login/?msg=${encodeURIComponent(r)}`}return null}async function isUserAccountExpired(e){try{if(e){const e=new ManageUser,t=await e.getUserSettings();if(t&&Object.keys(t).length>0){if("admin"===t.user_status.status)return;let e=new Date(t.user_status.expiry),r=new Date;if("member"===t.user_status.status&&e.setDate(e.getDate()+3),!(r>e))return!0;{const e="It appears that your account has expired.<br>If this is incorrect, please email the administrator at 'farriers.clienttracker@gmail.com'";window.location.href=`/login/?msg=${encodeURIComponent(e)}`}}else{const e="There was a problem validating your credentials.<br>Please try logging in again.";window.location.href=`/login/?msg=${encodeURIComponent(e)}`}}else{const e="We could not locate your credentials.<br>Please try logging in again.";window.location.href=`/login/?msg=${encodeURIComponent(e)}`}}catch(e){const{default:t}=await import("../../utils/error-messages/errorLogs.js");await t("isUserAccountExpiredError","Is User Account Expired Error: ",e)}}
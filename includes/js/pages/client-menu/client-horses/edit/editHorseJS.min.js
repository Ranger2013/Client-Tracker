// @ts-nocheck
import ManageClient from"../../../../classes/ManageClient.js";import{clearMsg,disableEnableSubmitButton,myError,mySuccess}from"../../../../utils/dom/domUtils.js";import{addListener}from"../../../../utils/event-listeners/listeners.js";import{ucwords}from"../../../../utils/string/stringUtils.js";export default async function editHorse({cID:e,mainContainer:t,clientHorses:r}){try{addListener("horse-name","input",(e=>{const t=e.target.value.toLowerCase().trim(),o=document.querySelector('input[name="hID"]').value;if(e.target.value=ucwords(e.target.value),""===t)return myError(`${e.target.id}-error`,"Horse's name is required.",e.target.id),disableEnableSubmitButton("submit-button",!1),void disableEnableSubmitButton("delete-button",!1);r.some((e=>e.hID!==o&&e.horse_name.toLowerCase().trim()===t))?(myError(`${e.target.id}-error`,`${e.target.value} is already listed.`,e.target.id),disableEnableSubmitButton("submit-button",!1),disableEnableSubmitButton("delete-button",!1)):(clearMsg({container:`${e.target.id}-error`,hide:!0,input:e.target}),disableEnableSubmitButton("submit-button",!0),disableEnableSubmitButton("delete-button",!0)),addListener(e.target,"focus",(e=>clearMsg({container:`${e.target.id}-error`,hide:!0,input:e.target})))})),addListener("edit-horse-form","submit",(async r=>{r.preventDefault();const o=await handleEditHorseFormSubmission(r,e);if(!0===o.status)return mySuccess("form-msg",o.msg),o.horse_name?updateHorseSelectOption(o.hID,o.horse_name):removeHorseSelectOption(o.hID),void(t.innerHTML="");!1!==o.status||myError("form-msg",o.msg)}))}catch(e){const{handleError:t}=await import("../../../../utils/error-messages/handleError.js");await t("editHorseError","Edit horse error: ",e)}}async function handleEditHorseFormSubmission(e,t){try{const r=new ManageClient,o=e.submitter.name,s=Object.fromEntries(new FormData(e.target)),i=s.hID,n=s.horse_name;if("submit"===o){return{...await r.editClientHorse(i,t,n),hID:i,horse_name:n}}if("delete"===o){if(confirm("Are you sure you want to delete this horse?")){await r.getClientInfo(t);return{...await r.deleteClientHorse(i,t),hID:i}}return{status:!1,msg:"Horse deletion cancelled."}}}catch(e){const{handleError:t}=await import("../../../../utils/error-messages/handleError.js");await t("editHorseError","Edit horse error: ",e,"Unable to edit the horse at this time.","form-msg")}}function updateHorseSelectOption(e,t){const r=document.getElementById("horse-list").querySelector(`option[value="${e}"]`);r&&(r.text=t)}function removeHorseSelectOption(e){const t=document.getElementById("horse-list").querySelector(`option[value="${e}"]`);t&&t.remove()}
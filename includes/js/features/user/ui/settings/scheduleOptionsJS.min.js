// @ts-nocheck
import{disableEnableSubmitButton}from"../../../../core/utils/dom/elements.js";import{addListener,removeListeners}from"../../../../core/utils/dom/listeners.js";import{clearMsg,safeDisplayMessage}from"../../../../core/utils/dom/messages.js";import{underscoreToHyphen,underscoreToHyphenPlusError}from"../../../../core/utils/string/stringUtils.js";import{isNumeric}from"../../../../core/utils/validation/validators.js";import ManageUser from"../../models/ManageUser.js";import populateScheduleOptionsForm from"./components/schedule-options/populateScheduleOptionsForm.js";const manageUser=new ManageUser,COMPONENT_ID="schedule-options";async function initializeEventHandlers(){try{const e=e=>s=>{isNumeric(s.target.value)||(safeDisplayMessage({elementId:`${e}-error`,message:"Please enter a valid number",targetId:e}),disableEnableSubmitButton("submit-button"))},s=e=>()=>{clearMsg({container:`${e}-error`,hide:!0,input:e}),disableEnableSubmitButton("submit-button")},r=["avg-trim","half-set","full-set","avg-drive-time"].reduce(((r,t)=>(r[`input:${t}`]=e(t),r[`focusin:${t}`]=s(t),r)),{"submit:schedule-options-form":handleScheduleFormSubmission});addListener({elementOrId:"schedule-options-form",eventType:["input","focusin","submit"],handler:e=>{const s=`${e.type}:${e.target.id}`;r[s]?.(e)},componentId:COMPONENT_ID})}catch(e){const{AppError:s}=await import("../../../../core/errors/models/AppError.js");s.handleError(e,{errorCode:s.Types.INITIALIZATION_ERROR,userMessage:s.BaseMessages.system.initialization}),disableEnableSubmitButton("submit-button")}}async function handleScheduleFormSubmission(e){e.preventDefault();try{clearMsg({container:"form-msg"});const s=Object.fromEntries(new FormData(e.target)),r=manageUser.getStoreNames();if(await manageUser.updateLocalUserSettings({userData:s,settingsProperty:"schedule_options",backupStore:r.SCHEDULINGOPTIONS,backupAPITag:"add_scheduleOptions"}))return void safeDisplayMessage({elementId:"form-msg",message:"Schedule Options have been saved.",isSuccess:!0});throw new Error("Failed to save schedule options")}catch(e){const{AppError:s}=await import("../../../../core/errors/models/AppError.js");s.handleError(e,{errorCode:s.Types.FORM_SUBMISSION_ERROR,userMessage:s.BaseMessages.system.formSubmission,displayTarget:"form-msg"})}}!async function(){await populateScheduleOptionsForm({form:"schedule-options-form",manageUser:manageUser}),await initializeEventHandlers()}();
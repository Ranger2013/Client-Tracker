// @ts-nocheck
import IndexedDBOperations from"../../../../../../../core/database/IndexedDBOperations.js";import{buildEle,buildElementsFromConfig,buildElementTree}from"../../../../../../../core/utils/dom/elements.js";import{ucwords,underscoreToHyphen,underscoreToSpaces}from"../../../../../../../core/utils/string/stringUtils.js";const COMPONENT="Build Page Components",DEBUG=!1,debugLog=(...e)=>{false};export default async function buildBackupDataPageComponents({manageUser:e,objectStoreRows:t}){try{const t=buildMainPageComponents();debugLog();const o=await buildBackupDataRows({manageUser:e});return debugLog(),t.storeRowsContainer.appendChild(o),debugLog(),t}catch(e){throw e}}function buildMainPageComponents(){const e=buildElementsFromConfig({container:{type:"div",myClass:["w3-container"]},titleContainer:{type:"div",myClass:["w3-center"]},title:{type:"h5",text:"Backup Your Data to the Server"},successContainer:{type:"div",attributes:{id:"backup-msg-success"},myClass:["w3-padding-small","w3-text-green"]},buttonContainer:{type:"div",attributes:{id:"backup-data-button-container"},myClass:["w3-center","w3-padding-small","w3-hide"]},button:{type:"button",attributes:{id:"backup-data-submit-button"},myClass:["w3-button","w3-black","w3-round-large","w3-card"],text:"Backup Data"},storeRowsContainer:{type:"div",attributes:{id:"store-rows-container"},myClass:["w3-margin-top"]}});return debugLog(),e}async function buildBackupDataRows({manageUser:e}){const t=await buildObjectStoreStructure();debugLog();const o=document.createDocumentFragment();Object.entries(t).map((([e,t])=>{const a=buildStoreRow({storeList:t});return o.appendChild(a),o}));return debugLog(),o}function buildStoreRow({storeList:e}){debugLog();const{hasData:t,indicatorId:o,message:a,storeName:n}=e,r=buildElementTree({type:"div",myClass:["w3-row","w3-border-bottom","w3-padding-top","w3-padding-bottom"],children:{firstCol:{type:"div",myClass:["w3-col","s11","w3-small"],text:`${a} is ${t?"out of sync:":"in sync:"}`},secondCol:{type:"div",myClass:["w3-col","s1"],children:{imgIndicator:{type:"img",attributes:{src:""+(t?"/public/siteImages/indicator_blue_light.png":"/public/siteImages/indicator_green_light.webp"),alt:""+(t?"Blue light indicator":"Green light indicator"),title:""+(t?"Blue light indicator":"Green light indicator"),width:"25px",height:"25px","data-hasdata":t,"data-store":n}}}}}});return debugLog(),r}async function buildObjectStoreStructure(){const e=new IndexedDBOperations({debug:!1}),t=await e.openDBPromise(),o=e.stores,a=await Promise.all(Object.entries(o).filter((([e,t])=>t.includes("backup_"))).map((async([o,a])=>{const n=(await e.getAllStorePromise(t,a)).length>0,r=a.replace("backup_",""),i=ucwords(underscoreToSpaces(r),!1).replace(/ /g,""),s=ucwords(underscoreToSpaces(r));return[i,{indicatorId:`${underscoreToHyphen(r)}-indicator`,storeName:a,message:`${s}`,hasData:n}]})));return debugLog(),Object.fromEntries(a)}
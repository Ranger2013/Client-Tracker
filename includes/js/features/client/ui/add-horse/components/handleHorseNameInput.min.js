// @ts-nocheck
import{disableEnableSubmitButton}from"../../../../../core/utils/dom/elements";import{addListener}from"../../../../../core/utils/dom/listeners";import{clearMsg,safeDisplayMessage}from"../../../../../core/utils/dom/messages";import{ucwords,underscoreToHyphen,underscoreToHyphenPlusError}from"../../../../../core/utils/string/stringUtils";const COMPONENT="Add Horse Page",DEBUG=!0,debugLog=(...e)=>{console.log(`[${COMPONENT}]`,...e)};export async function handleHorseNameInput({evt:e,cID:r,primaryKey:t,manageClient:s,componentId:a}){try{const a=e.target.value,o=`${e.target.id}-error`;if(!a)return void clearMsg({container:o,hide:!0,input:e.target});return await isDuplicateHorseName({horseName:a,cID:r,primaryKey:t,manageClient:s})?(safeDisplayMessage({elementId:o,message:`${a} is already listed.`,targetId:e.target.id}),disableEnableSubmitButton("submit-button"),void clearMsg({container:"form-msg"})):(e.target.value=ucwords(a),clearMsg({container:o,hide:!0,input:e.target}),clearMsg({container:"form-msg"}),document.getElementById("submit-button").disabled=!1,void disableEnableSubmitButton("submit-button"))}catch(e){const{AppError:r}=await import("../../../../../core/errors/models/AppError.js");r.handleError(e,{errorCode:r.Types.INITIALIZATION_ERROR,userMessage:r.BaseMessages.system.initialization})}}export async function isDuplicateHorseName({horseName:e,cID:r,primaryKey:t,manageClient:s}){try{const r=await s.getClientHorses({primaryKey:t});return!!r?.length&&r.some((r=>r.horse_name.toLowerCase()===e.trim().toLowerCase()))}catch(e){throw e}}export async function handleAddHorseFormSubmission({evt:e,cID:r,primaryKey:t,manageClient:s,componentId:a}){try{const a=Object.fromEntries(new FormData(e.target)),o=a.horse_name.trim();r=parseInt(r,10),t=parseInt(t,10);const i=await validateAddHorseForm(a);if(!i)return;debugLog("Validation:",i);await s.addNewHorse({userData:a,cID:r,primaryKey:t})&&(e.target.reset(),safeDisplayMessage({elementId:"form-msg",message:`${o} has been added.`,isSuccess:!0}))}catch(e){const{AppError:r}=await import("../../../../../core/errors/models/AppError.js");r.handleError(e,{errorCode:r.Types.FORM_SUBMISSION_ERROR,userMessage:r.BaseMessages.forms.submissionFailed,displayTarget:"form-msg"})}}async function validateAddHorseForm(e){try{const r=[{test:()=>!!e.horse_name?.trim(),error:{message:"Please enter a horse name.",targetError:"horse-name-error",target:"horse-name"}},{test:()=>["7","14","21","28","35","42","49","56","63","70"].includes(e.trim_cycle),error:{message:"Please select a valid trim cycle.",targetError:"trim-cycle-error",target:"trim-cycle"}}].filter((e=>!e.test())).map((e=>e.error));return!(r.length>0)||(r.forEach((e=>{safeDisplayMessage({elementId:e.targetError,message:e.message,targetId:e.target})})),!1)}catch(e){const{AppError:r}=await import("../../../../../core/errors/models/AppError.js");r.process(e,{errorCode:r.Types.VALIDATION_ERROR,userMessage:r.BaseMessages.forms.validationFailed},!0)}}
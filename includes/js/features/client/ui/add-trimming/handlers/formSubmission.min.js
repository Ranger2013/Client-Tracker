// @ts-nocheck
import{disableEnableSubmitButton}from"../../../../../core/utils/dom/elements.js";import{clearMsg,safeDisplayMessage}from"../../../../../core/utils/dom/messages.js";import{top}from"../../../../../core/utils/window/scroll.js";import ManageTrimming from"../../../models/ManageTrimming.js";const COMPONENT="Form Submission",DEBUG=!0,debugLog=(...e)=>{console.log(`[${COMPONENT}]`,...e)};export default async function handleAddTrimmingFormSubmission({evt:e,cID:r,primaryKey:s,mainContainer:o,manageClient:t}){try{clearMsg({container:"form-msg"});const o=processFormData(new FormData(e.target)),t=await validateTrimmingForm({userData:o});debugLog("Validation:",t);const{status:n,message:a,target:i,targetError:m}=t;if(!n)return safeDisplayMessage({elementId:"form-msg",message:"Please fix the following errors:"}),safeDisplayMessage({elementId:m,message:a,targetId:i}),top(),void disableEnableSubmitButton("submit-button");const u=new ManageTrimming,g=await u.handleAddTrimmingSession({cID:r,primaryKey:s,userData:o});debugLog("Form Submission:",g),safeDisplayMessage({elementId:"form-msg",message:g.message,isSuccess:"ok"===g.status}),e.target.reset(),top(),document.getElementById("number-horse-container").innerHTML=""}catch(e){console.warn("Error submitting form:",e);const{AppError:r}=await import("../../../../../core/errors/models/AppError.js");r.handleError(e,{errorCode:r.Types.FORM_SUBMISSION_ERROR,userMessage:r.BaseMessages.forms.submissionFailed,displayTarget:"form-msg"})}}function processFormData(e){try{const r=Array.from(e.entries());debugLog("Form Entries:",r);const s=r.reduce(((e,[r,s])=>(debugLog("Processing:",{key:r,value:s}),{...e,...processFormField(r,s,e)})),{});return debugLog("Processed Data:",s),s}catch(e){throw console.error("Error processing form data:",e),e}}function processFormField(e,r,s){if("number-horses"===e)return{number_horses:r};if(e.startsWith("horse_list_"))return{[e]:r??"null"};if(e.startsWith("accessories_")){const o=s[e]??[];return r.trim()?{[e]:[...o,r]}:{[e]:o}}return r.trim()||"0"===r?{[e]:r}:{}}async function validateTrimmingForm({userData:e}){try{return e.number_horses&&"0"!==e.number_horses&&""!==e.number_horses?{status:!0}:{status:!1,message:"Please enter the number of horses.",targetError:"number-horses-error",target:"number-horses"}}catch(e){throw e}}async function formSubmission({cID:e,primaryKey:r,userData:s,manageClient:o}){try{const r=new ManageTrimming;console.log("BEFORE SUBMIT FORM");const o=await r.handleAddTrimmingSession({cID:e,userData:s});console.log("SUBMIT FORM: ",o),debugLog("Form Submission:",o)}catch(e){throw e}}function getReceiptMessage(e){return{success:"Receipt sent successfully","auth-error":"Authorization error sending receipt",error:"Server error sending receipt - will retry during backup",offline:"Receipt will be sent when online"}[e]||null}
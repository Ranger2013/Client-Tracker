// @ts-nocheck
import{disableEnableSubmitButton}from"../../../../../core/utils/dom/elements.js";import{clearMsg,safeDisplayMessage}from"../../../../../core/utils/dom/messages.js";import{top}from"../../../../../core/utils/window/scroll.js";import ManageTrimming from"../../../models/ManageTrimming.js";const COMPONENT="Form Submission",DEBUG=!1,debugLog=(...e)=>{false};export default async function handleAddTrimmingFormSubmission({evt:e,cID:r,primaryKey:s,mainContainer:t,manageClient:o}){try{clearMsg({container:"form-msg"});const t=processFormData(new FormData(e.target));debugLog();const o=await validateTrimmingForm({userData:t}),{status:n,message:a,target:i,targetError:m}=o;if(!n)return safeDisplayMessage({elementId:"form-msg",message:"Please fix the following errors:"}),safeDisplayMessage({elementId:m,message:a,targetId:i}),top(),void disableEnableSubmitButton("submit-button");const u=new ManageTrimming({debug:!1}),l=await u.handleAddTrimmingSession({cID:r,primaryKey:s,userData:t});debugLog(),safeDisplayMessage({elementId:"form-msg",message:l.message,isSuccess:"ok"===l.status}),handleFormReset({evt:e,numberHorseContainer:"number-horse-container",userData:t})}catch(e){console.warn("Error submitting form:",e);const{AppError:r}=await import("../../../../../core/errors/models/AppError.js");r.handleError(e,{errorCode:r.Types.FORM_SUBMISSION_ERROR,userMessage:r.BaseMessages.forms.submissionFailed,displayTarget:"form-msg"})}}function processFormData(e){try{const r=Array.from(e.entries());return r.reduce(((e,[r,s])=>({...e,...processFormField(r,s,e)})),{})}catch(e){throw console.error("Error processing form data:",e),e}}function processFormField(e,r,s){if("number-horses"===e)return{number_horses:r};if(e.startsWith("horse_list_"))return{[e]:r??"null"};if(e.startsWith("accessories_")){const t=s[e]??[];return r.trim()?{[e]:[...t,r]}:{[e]:t}}return r.trim()||"0"===r?{[e]:r}:{}}async function validateTrimmingForm({userData:e}){try{return e.number_horses&&"0"!==e.number_horses&&""!==e.number_horses?{status:!0}:{status:!1,message:"Please enter the number of horses.",targetError:"number-horses-error",target:"number-horses"}}catch(e){throw e}}function getReceiptMessage(e){return{success:"Receipt sent successfully","auth-error":"Authorization error sending receipt",error:"Server error sending receipt - will retry during backup",offline:"Receipt will be sent when online"}[e]||null}function handleFormReset({evt:e,numberHorseContainer:r,userData:s}){debugLog();const{trim_date:t,next_trim_date:o,app_time:n}=s;e.target.reset(),document.getElementById("trim-date").value=t,document.getElementById("next-trim-date").value=o,document.getElementById("app-time").value=n,document.getElementById(r).innerHTML="",top()}
// @ts-nocheck
import{buildEle,buildElementsFromConfig,disableEnableSubmitButton}from"../../../../core/utils/dom/elements.min.js";import{addListener}from"../../../../core/utils/dom/listeners.min.js";import{cleanUserOutput}from"../../../../core/utils/string/stringUtils.min.js";import clientAnchorNav from"../../../../core/navigation/components/setupClientAnchorListener.min.js";import{clearMsg,safeDisplayMessage}from"../../../../core/utils/dom/messages.min.js";import{createDebouncedHandler,getOptimalDelay}from"../../../../core/utils/dom/eventUtils.min.js";import{handleHorseNameInput}from"../add-horse/components/handleHorseNameInput.min.js";import handleEditHorseFormSubmission from"./components/handleEditHorseFormSubmission.min.js";import{trimCycleConfigurations}from"../../../../core/utils/dom/forms/trimCycleConfigurations.min.js";import{buildSubmitDeleteButtonSection,buildTwoColumnInputSection,buildTwoColumnRadioButtonSection,buildTwoColumnSelectElementSection}from"../../../../core/utils/dom/forms/buildUtils.min.js";export default async function editClientHorse({cID:e,primaryKey:t,mainContainer:o,manageClient:n,manageUser:r,componentId:i}){try{await clientAnchorNav({manageClient:n,manageUser:r,componentId:i});const o=createDebouncedHandler((o=>{handleHorseNameInput({evt:o,cID:e,primaryKey:t,manageClient:n,componentId:i})}),getOptimalDelay("validation")),s={"change:horse-list":async o=>{await showEditHorseForm({evt:o,cID:e,primaryKey:t,manageClient:n,manageUser:r,componentId:i})},"input:horse-name":e=>{""!==e.target.value&&(safeDisplayMessage({elementId:"form-msg",message:"Processing...",isSuccess:!0,color:"w3-text-blue"}),document.getElementById("submit-button").disabled=!0),o(e)},"focusin:horse-name":e=>{clearMsg({container:`${e.target.id}-error`,hide:!0,input:e.target}),disableEnableSubmitButton("submit-button")},"focusin:horse-type":e=>{clearMsg({container:`${e.target.id}-error`,hide:!0,input:e.target}),disableEnableSubmitButton("submit-button")},"submit:edit-horse-form":async o=>{o.preventDefault();const r=document.getElementById("horse-container");await handleEditHorseFormSubmission({evt:o,cID:e,primaryKey:t,horseContainer:r,manageClient:n,componentId:i})}};addListener({elementOrId:"card",eventType:["focusin","change","submit","input"],handler:e=>{const t=`${e.type}:${e.target.id}`;s[t]&&s[t](e)},componentId:i})}catch(e){const{AppError:t}=await import("../../../../core/errors/models/AppError.min.js");t.handleError(e,{errorCode:t.Types.INITIALIZATION_ERROR,userMessage:t.BaseMessages.system.initialization})}}async function showEditHorseForm({evt:e,cID:t,primaryKey:o,manageClient:n,manageUser:r,componentId:i}){try{const t=document.getElementById("horse-container"),n=e.target.options[e.target.selectedIndex],r=e.target.value,i=n.text,s=n.dataset.horseType,a=n.dataset.serviceType,l=n.dataset.trimCycle;if("null"===r)return void(t.innerHTML="");const m=buildElementsFromConfig({form:{type:"form",attributes:{id:"edit-horse-form"}},hiddenHID:{type:"input",attributes:{type:"hidden",name:"hID",value:r}},hiddenPrimaryKey:{type:"input",attributes:{type:"hidden",name:"primaryKey",value:o}}}),[u,c,d,p,y]=await Promise.all([buildTwoColumnInputSection({labelText:"Horse's Name: ",inputID:"horse-name",inputType:"text",inputName:"horse_name",inputValue:cleanUserOutput(i),inputTitle:"Horse's Name",required:!0}),buildTwoColumnSelectElementSection({labelText:"Horse Type: ",selectID:"horse-type",selectName:"horse_type",selectTitle:"Horse Type",required:!0,options:typeHorse(s)}),buildTwoColumnRadioButtonSection({labelText:"Service Type: ",buttons:[{name:"service_type",value:"trim",labelText:"Trim: ",checked:"trim"===a||void 0},{name:"service_type",value:"half_set",labelText:"Half Set Shoes: ",checked:"half_set"===a||void 0},{name:"service_type",value:"full_set",labelText:"Full Set Shoes: ",checked:"full_set"===a||void 0}]}),buildTwoColumnSelectElementSection({labelText:"Trim Cycle: ",selectID:"trim-cycle",selectName:"trim_cycle",selectTitle:"Trim Cycle",required:!0,options:trimCycleConfigurations({trim_cycle:l})}),buildSubmitDeleteButtonSection({submitButtonText:"Edit Horse",deleteButtonText:"Delete Horse"})]);m.form.append(m.hiddenHID,m.hiddenPrimaryKey,u,c,d,p,y),t.innerHTML="",t.appendChild(m.form)}catch(e){const{AppError:t}=await import("../../../../core/errors/models/AppError.min.js");t.handleError(e,{errorCode:t.Types.RENDER_ERROR,userMessage:"An error occurred while trying to show the edit horse form.",displayTarget:"horse-container"})}}function typeHorse(e){return[{value:"null",text:"-- Select Horse Type --"},{value:"draft",text:"Draft"},{value:"horse",text:"Horse"},{value:"mule",text:"Mule"},{value:"donkey",text:"Donkey"},{value:"mini_donkey",text:"Mini Donkey"},{value:"pony",text:"Pony"},{value:"mini_pony",text:"Mini Pony"}].map((t=>({value:t.value,text:t.text,selected:e===t.value||void 0})))}
// @ts-nocheck
import{dropDownClientMenu}from"../../../../core/navigation/services/dropDownClientMenu.js";import selectClientMenuPage from"../../../../core/navigation/services/selectClientMenuPage.js";import{getValidElement}from"../../../../core/utils/dom/elements.js";import{createDebouncedHandler,getOptimalDelay}from"../../../../core/utils/dom/eventUtils.js";import{addListener,removeListeners}from"../../../../core/utils/dom/listeners.js";import{safeDisplayMessage}from"../../../../core/utils/dom/messages.js";import{handleSearch}from"./components/searchHandlers.js";const COMPONENT_ID="schedule-list";export default async function appointmentList({active:e,cID:t,primaryKey:a,manageClient:r,manageUser:s,mainContainer:n,componentId:o}){try{try{await initializeSearchHandlers({manageUser:s}),await initializePersonalNotes()}catch(e){const{AppError:t}=await import("../../../../core/errors/models/AppError.js");t.handleError(e,{errorCode:t.Types.INITIALIZATION_ERROR,userMessage:t.BaseMessages.system.initialization})}try{await initializeMenuHandlers({cID:t,primaryKey:a,manageClient:r,manageUser:s,mainContainer:n})}catch(e){const{AppError:t}=await import("../../../../core/errors/models/AppError.js");t.handleError(e,{errorCode:t.Types.INITIALIZATION_ERROR,userMessage:t.BaseMessages.system.initialization})}}catch(e){const{AppError:t}=await import("../../../../core/errors/models/AppError.js");t.handleError(e,{errorCode:t.Types.INITIALIZATION_ERROR,userMessage:t.BaseMessages.system.initialization})}}function initializePersonalNotes(){addListener({elementOrId:"info-icon",eventType:"click",handler:()=>{const e=getValidElement("personal-notes-block");e.classList.contains("collapsed")?(e.classList.remove("w3-hide"),e.style.maxHeight=e.scrollHeight+30+"px",e.classList.remove("collapsed")):(e.style.maxHeight=e.scrollHeight+30+"px",setTimeout((()=>{e.style.maxHeight="0px",e.classList.add("collapsed"),setTimeout((()=>e.classList.add("w3-hide")),500)}),10))},componentId:COMPONENT_ID})}async function initializeSearchHandlers({manageUser:e}){try{const t=document.getElementById("filter"),a=document.getElementById("search");if(!t||!a)throw new Error("Search elements not found");const r=createDebouncedHandler((t=>handleSearch({evt:t,manageUser:e})),getOptimalDelay("search"));addListener({elementOrId:a,eventType:"input",handler:e=>{e.target.value&&safeDisplayMessage({elementId:"page-msg",message:"Searching...",isSuccess:!0,color:"w3-text-blue"}),r(e)},componentId:COMPONENT_ID}),addListener({elementOrId:t,eventType:"change",handler:e=>{a.value&&safeDisplayMessage({elementId:"page-msg",message:"Searching...",isSuccess:!0,color:"w3-text-blue"}),r({target:{value:a.value}})},componentId:COMPONENT_ID})}catch(e){const{AppError:t}=await import("../../../../core/errors/models/AppError.js");t.process(e,{errorCode:t.Types.INITIALIZATION_ERROR,userMessage:"Search functionality not available at the moment.",displayTarget:"page-msg"},!0)}}function initializeMenuHandlers({cID:e,primaryKey:t,manageClient:a,manageUser:r,mainContainer:s}){const n=document.getElementById("appointment-list");n&&addListener({elementOrId:n,eventType:"click",handler:async n=>{try{if(n.target.closest('[data-action="manage-client"]'))return void await dropDownClientMenu(n);const o=n.target.closest("[data-page]"),i=e||o?.dataset.clientid,l=t||o?.dataset.primarykey;if(o){n.preventDefault();const e=o.dataset.page;return void(e&&await selectClientMenuPage({evt:n,page:e,cID:i,primaryKey:l,manageClient:a,manageUser:r,mainContainer:s}))}if(!n.target.closest(".w3-dropdown-content")){document.querySelectorAll(".w3-dropdown-content.w3-show").forEach((e=>e.classList.remove("w3-show")))}}catch(e){const{AppError:t}=await import("../../../../core/errors/models/AppError.js");t.handleError(e,{errorCode:t.Types.INITIALIZATION_ERROR,userMessage:"Manage client menu not available at the moment."})}},componentId:COMPONENT_ID})}
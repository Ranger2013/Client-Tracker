// @ts-nocheck
import{dropDownClientMenu}from"../../../../core/navigation/services/dropDownClientMenu";import selectClientMenuPage from"../../../../core/navigation/services/selectClientMenuPage";import{createDebouncedHandler,getOptimalDelay}from"../../../../core/utils/dom/eventUtils";import{addListener,removeListeners}from"../../../../core/utils/dom/listeners";import{safeDisplayMessage}from"../../../../core/utils/dom/messages";import{handleSearch}from"./components/searchHandlers";const COMPONENT_ID="schedule-list";export default async function appointmentList({active:e,cID:r,primaryKey:a,manageClient:t,manageUser:n,mainContainer:s,componentId:o}){try{try{await initializeSearchHandlers({manageUser:n})}catch(e){const{AppError:r}=await import("../../../../core/errors/models/AppError.js");r.handleError(e,{errorCode:r.Types.INITIALIZATION_ERROR,userMessage:r.BaseMessages.system.initialization})}try{await initializeMenuHandlers({cID:r,primaryKey:a,manageClient:t,manageUser:n,mainContainer:s})}catch(e){const{AppError:r}=await import("../../../../core/errors/models/AppError.js");r.handleError(e,{errorCode:r.Types.INITIALIZATION_ERROR,userMessage:r.BaseMessages.system.initialization})}}catch(e){const{AppError:r}=await import("../../../../core/errors/models/AppError.js");r.handleError(e,{errorCode:r.Types.INITIALIZATION_ERROR,userMessage:r.BaseMessages.system.initialization})}}async function initializeSearchHandlers({manageUser:e}){try{const r=document.getElementById("filter"),a=document.getElementById("search");if(!r||!a)throw new Error("Search elements not found");const t=createDebouncedHandler((r=>handleSearch({evt:r,manageUser:e})),getOptimalDelay("search"));addListener({elementOrId:a,eventType:"input",handler:e=>{e.target.value&&safeDisplayMessage({elementId:"page-msg",message:"Searching...",isSuccess:!0,color:"w3-text-blue"}),t(e)},componentId:COMPONENT_ID}),addListener({elementOrId:r,eventType:"change",handler:e=>{a.value&&safeDisplayMessage({elementId:"page-msg",message:"Searching...",isSuccess:!0,color:"w3-text-blue"}),t({target:{value:a.value}})},componentId:COMPONENT_ID})}catch(e){const{AppError:r}=await import("../../../../core/errors/models/AppError.js");r.process(e,{errorCode:r.Types.INITIALIZATION_ERROR,userMessage:"Search functionality not available at the moment.",displayTarget:"page-msg"},!0)}}function initializeMenuHandlers({cID:e,primaryKey:r,manageClient:a,manageUser:t,mainContainer:n}){const s=document.getElementById("appointment-list");s&&addListener({elementOrId:s,eventType:"click",handler:async s=>{try{if(s.target.closest('[data-action="manage-client"]'))return void await dropDownClientMenu(s);const o=s.target.closest("[data-page]"),i=e||o?.dataset.clientid,c=r||o?.dataset.primarykey;if(o){s.preventDefault();const e=o.dataset.page;return void(e&&await selectClientMenuPage({evt:s,page:e,cID:i,primaryKey:c,manageClient:a,manageUser:t,mainContainer:n}))}if(!s.target.closest(".w3-dropdown-content")){document.querySelectorAll(".w3-dropdown-content.w3-show").forEach((e=>e.classList.remove("w3-show")))}}catch(e){const{AppError:r}=await import("../../../../core/errors/models/AppError.js");r.handleError(e,{errorCode:r.Types.INITIALIZATION_ERROR,userMessage:"Manage client menu not available at the moment."})}},componentId:COMPONENT_ID})}
// @ts-nocheck
import{getValidElement}from"../../utils/dom/elements.js";import{clearMsg,safeDisplayMessage}from"../../utils/dom/messages.js";import buildAppointmentBlock from"./components/buildAppointmentBlock.js";import buildNoAppointmentsBlock from"./components/buildNoAppointmentsBlock.js";import buildProjectedAppointmentBlock from"./components/buildProjectedAppointmentBlock.js";import getCurrentAppointments from"./components/getCurrentAppointments.js";import getProjectedAppointments from"./components/getProjectedAppointments.js";const COMPONENT_ID="check-appointment";export default async function checkAppointment({trimDate:e,trimCycle:t,appBlock:n,projAppBlock:o,clientInfo:i=null,manageClient:a,manageUser:p}){console.log("In checkAppointment:");try{e=getValidElement(e),t=getValidElement(t),n=getValidElement(n),o=getValidElement(o);const r=document.getElementById(`${e.id}-error`),l=new Date(e.value.replace(/-/g,"/")).toDateString(),[s,m,c]=await Promise.all([p.getScheduleOptions(),p.getDateTimeOptions(),p.getUserBlockedDates()??[]]);if(0===Object.keys(s).length||0===Object.keys(m).length)throw new Error("User schedule options or date time formats are missing. Please update your settings.");let d,g;c?.includes(e.value)?safeDisplayMessage({elementOrId:r,message:"You have blocked out this date.",targetId:r}):clearMsg({container:r,hide:!0,input:r});try{[d,g]=await Promise.all([getCurrentAppointments({appointmentDate:e.value,scheduleOptions:s,dateTimeFormats:m,manageClient:a}),getProjectedAppointments({appointmentDate:e,trimCycle:t,clientInfo:i,scheduleOptions:s,manageClient:a})])}catch(e){console.log("In checkAppointent: after current and projected appointments: err: ",e)}d?.length>0?await buildAppointmentBlock({appointmentContainer:n,appointments:d,date:l,manageClient:a,manageUser:p,componentId:COMPONENT_ID}):await buildNoAppointmentsBlock({appointmentContainer:n,date:l}),g?.length>0&&await buildProjectedAppointmentBlock({appointmentContainer:o,data:g,date:l})}catch(e){console.log("In checkAppointment: err: ",e);const{AppError:t}=await import("../../errors/models/AppError.js");t.handleError(e,{errorCode:t.Types.RENDER_ERROR,userMessage:"Unable to check appointment availability.",displayTarget:n})}}
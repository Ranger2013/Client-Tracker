// @ts-nocheck
import{sortByTrimDateAndAppTime}from"../../../utils/date/dateUtils.js";import appointmentBlockData from"./appointmentBlockData.js";import predictNextSessionNumberHorses from"./predictNextSessionNumberHorses.js";const COMPONENT="getCurrentAppointments",DEBUG=!1,debugLog=(...t)=>{false};export default async function getCurrentAppointments({appointmentDate:t,scheduleOptions:e,dateTimeFormats:o,manageClient:i=null}){try{if(!e||!o)throw new Error("No Schedule Options or Date/Time Options to create booked appointments. Please update your settings.");const{avg_horses:n,avg_drive_time:a}=e,{date_format:r,time_format:s}=o;let m=[];debugLog();const p=await i.getClientScheduleByTrimDate(t);if(debugLog(),0===p.length)return null;p.sort(((t,e)=>sortByTrimDateAndAppTime(t,e,!0)));let c=new Set;for(let t of p){const{cID:e,primaryKey:o,active:p,client_name:l,city:u,horses:d,app_time:g}=t;if("no"===p)continue;if(c.has(e))continue;c.add(e);const f=d.length>0?d.length:1,_={cID:e,primary_key:o,client_name:l,city:u,num_horses:await predictNextSessionNumberHorses({clientID:e,manageClient:i,totalHorses:f}),avg_horses:n,avg_drive_time:a,app_time:g,time_format:s,date_format:r};m.push(await appointmentBlockData(_))}return m}catch(t){throw t}}
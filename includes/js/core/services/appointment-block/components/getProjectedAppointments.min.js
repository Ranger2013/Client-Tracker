// @ts-nocheck
import getBlockOfTime from"./getBlockOfTime.js";const COMPONENT="getProjectedAppointments",DEBUG=!1,debugLog=(...e)=>{false};export default async function getProjectedAppointments({appointmentDate:e,trimCycle:t,clientInfo:n,scheduleOptions:o,manageClient:i}){try{let s=n?.cID||null;if(!(n?.trim_cycle||("null"!==t.options[t.selectedIndex].value?t.options[t.selectedIndex].value:null)))return null;const[l,c,r]=e.value.split("-"),g=new Date(l,c-1,r);g.setHours(0,0,0,0);const a=new Date;a.setHours(0,0,0,0);const u=[],m=new Set;for(const e of[7,14,21,28,35,42,49,56,63,70]){const t=new Date(g);if(t.setDate(g.getDate()-e),t<=a)return u.length>0?u:null;debugLog(),debugLog(t.toISOString());const n=t.toISOString().slice(0,10);debugLog();const l=await i.getClientScheduleByTrimDate(n);if(debugLog(),l?.length>0)for(const t of l){if(m.has(t.cID)||t.cID===s||"no"===t.active||t.trim_cycle!==e.toString())continue;m.add(t.cID);const n=await buildProjectedBookingData(t,i,o);n&&u.push(n)}}return u.length>0?u:null}catch(e){throw e}}async function buildProjectedBookingData(e,t,n){const o=await t.getClientTrimmingInfo(e.cID),i=e.horses?.length||1,s=e.horses&&0!==e.horses.length?"":"New Client.";return{client_name:e.client_name,city:e.city,num_horses:o?.trimmings?.length>0?o.trimmings[o.trimmings.length-1].horses.length:i,new_client:s,time_block:await getBlockOfTime({avgHorses:n.avg_horses,numberHorses:i,avgDriveTime:n.avg_drive_time})}}
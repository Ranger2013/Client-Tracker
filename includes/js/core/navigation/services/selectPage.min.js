// @ts-nocheck
import closeNavigationMenu from"./closeNavigationMenu.js";import{removeListeners}from"../../utils/dom/listeners.js";let cleanup=null;const main=document.getElementById("main");export default async function selectPage({evt:e,page:a,cID:t=null,closeMenu:i=null,primaryKey:n,manageUser:s,manageClient:r}){e.preventDefault();const l={clients:{active:{module:"../../layout/client/pages/schedule-list/buildAppointmentListPage.js",getState:()=>"/tracker/clients/appointments/?active=yes",getArgs:()=>[{active:"yes",mainContainer:main,manageClient:r,manageUser:s}]},inactive:{module:"../../layout/client/pages/schedule-list/buildAppointmentListPage.js",getState:()=>"/tracker/clients/appointments/?active=no",getArgs:()=>[{active:"no",mainContainer:main,manageClient:r,manageUser:s}]},add:{module:"../page-builders/pages/clients/add-edit-client/buildAddEditClientPage.js",getState:()=>"/tracker/clients/add/",getArgs:()=>[{cID:t,primaryKey:n,mainContainer:main}]},duplicate:{module:"../page-builders/pages/clients/add-duplicate/buildDuplicateClientPage.js",getState:()=>"/tracker/clients/duplicate/",getArgs:()=>[{mainContainer:main}]},deleteDuplicate:{module:"../page-builders/pages/clients/delete-duplicate/buildDeleteDuplicateClientPage.js",getState:()=>"/tracker/clients/delete-duplicate/",getArgs:()=>[{mainContainer:main}]}},management:{mileage:{module:"../page-builders/pages/mileage/buildAddMileagePage.js",getState:()=>"/tracker/mileage/add/",getArgs:()=>[{mainContainer:main}]},expenses:{add:{module:"../page-builders/pages/expenses/add/buildAddExpensesPage.js",getState:()=>"/tracker/expenses/add/",getArgs:()=>[{mainContainer:main}]},edit:{module:"../page-builders/pages/expenses/edit/buildEditExpensesPage.js",getState:()=>"/tracker/expenses/edit/",getArgs:()=>[{mainContainer:main}]}}},notes:{add:{module:"../page-builders/pages/personal-notes/add/buildAddPersonalNotesPage.js",getState:()=>"/tracker/personal-notes/add/",getArgs:()=>[{mainContainer:main}]},edit:{module:"../page-builders/pages/personal-notes/edit/buildEditPersonalNotesPage.js",getState:()=>"/tracker/personal-notes/edit/",getArgs:()=>[{mainContainer:main}]},view:{module:"../page-builders/pages/personal-notes/view/buildViewPersonalNotesPage.js",getState:()=>"/tracker/personal-notes/view/",getArgs:()=>[{mainContainer:main}]}}},o={activeClients:{config:l.clients.active,displayName:"Active Clients"},inactiveClients:{config:l.clients.inactive,displayName:"Inactive Clients"},addClient:{config:l.clients.add,displayName:"Add Client"},duplicateClient:{config:l.clients.duplicate,displayName:"Duplicate Client"},deleteDuplicateClient:{config:l.clients.deleteDuplicate,displayName:"Delete Duplicate Client"},addMileage:{config:l.management.mileage,displayName:"Add Mileage"},addExpenses:{config:l.management.expenses.add,displayName:"Add Expenses"},editExpenses:{config:l.management.expenses.edit,displayName:"Edit Expenses"},addPersonalNotes:{config:l.notes.add,displayName:"Add Personal Notes"},editPersonalNotes:{config:l.notes.edit,displayName:"Edit Personal Notes"},viewPersonalNotes:{config:l.notes.view,displayName:"View Personal Notes"}};try{cleanupServerRenderedListeners(),await cleanupPreviousPage(),i||closeNavigationMenu();const e=document.querySelectorAll(".w3-dropdown-content"),s=document.querySelectorAll(".arrow");e.forEach((e=>e.classList.remove("w3-show"))),s.forEach((e=>e.classList.remove("up")));const r=o[a];if(!r)throw new Error(`Unknown page: ${a}`);const{config:l,displayName:d}=r;await loadNewPage(l,a,t,n)}catch(e){console.log("In catch block for the display navigation error");const{displayNavigationError:t}=await import("../components/backupErrorPage.js");t({requestedPage:o[a].displayName||a,errorType:"ImportError"===e.name?"load":"build"});const{AppError:i}=await import("../../errors/models/AppError.js");i.handleError(e,{errorCode:i.Types.RENDER_ERROR,userMessage:null})}}async function cleanupPreviousPage(){cleanup&&(await cleanup(),cleanup=null)}async function loadNewPage(e,a,t,i){try{const n=await importModule(e.module),s=e.getArgs(t,i);cleanup=await n.default(...s);const r=e.getState(t,i);history.pushState({page:a},"",r)}catch(e){throw console.error("Error loading page:",e),e}}async function importModule(e){try{return await import(e)}catch(a){const t=new URL(e,"https://cavalierhorsemanship.com"+"/includes/js/utils/navigation/").pathname,i=await caches.match(t);if(!i)throw a;const n=await i.text(),s=new Blob([n],{type:"application/javascript"}),r=URL.createObjectURL(s);try{const e=await import(r);return URL.revokeObjectURL(r),e}catch(e){throw URL.revokeObjectURL(r),e}}}function cleanupServerRenderedListeners(){removeListeners("color-options"),removeListeners("farrier-prices"),removeListeners("date-time"),removeListeners("mileage-charges"),removeListeners("schedule-options")}
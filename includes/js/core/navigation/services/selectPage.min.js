// @ts-nocheck
import{hasListeners,removeListeners}from"../../utils/dom/listeners.js";let cleanup=null,isFromServerRenderedPage=!1;const main=document.getElementById("main");export default async function selectPage({evt:e,page:a,cID:t=null,closeMenu:n=null,primaryKey:i,manageUser:s,manageClient:r}){e.preventDefault(),isFromServerRenderedPage=await checkIfCurrentPageIsServerRendered();const o={clients:{active:{module:"../../layout/client/pages/schedule-list/buildAppointmentListPage.js",getState:()=>"/tracker/clients/appointments/?active=yes",getArgs:()=>[{active:"yes",mainContainer:main,manageClient:r,manageUser:s}]},inactive:{module:"../../layout/client/pages/schedule-list/buildAppointmentListPage.js",getState:()=>"/tracker/clients/appointments/?active=no",getArgs:()=>[{active:"no",mainContainer:main,manageClient:r,manageUser:s}]},single:{module:"../../layout/client/pages/schedule-list/buildAppointmentListPage.js",getState:(e,a)=>`/tracker/clients/appointments/?cID=${e}&primaryKey=${a}`,getArgs:(e,a)=>[{mainContainer:main,cID:e,primaryKey:a,manageClient:r,manageUser:s}]},add:{module:"../../layout/client/pages/add-edit-client/buildAddEditClientPage.js",getState:()=>"/tracker/clients/add-client/",getArgs:(e,a)=>[{cID:e,primaryKey:a,mainContainer:main,manageClient:r,manageUser:s}]},duplicate:{module:"../../layout/client/pages/duplicate-client/buildDuplicateClientPage.js",getState:()=>"/tracker/clients/duplicate/",getArgs:()=>[{mainContainer:main,manageClient:r,manageUser:s}]},deleteDuplicate:{module:"../../layout/client/pages/delete-duplicate/buildDeleteDuplicateClientPage.js",getState:()=>"/tracker/clients/delete-duplicate/",getArgs:()=>[{mainContainer:main,manageClient:r,manageUser:s}]}},management:{mileage:{add:{module:"../../layout/user/pages/mileage/add/buildAddMileagePage.js",getState:()=>"/tracker/mileage/add/",getArgs:()=>[{mainContainer:main,manageClient:r,manageUser:s}]}},expenses:{add:{module:"../../layout/user/pages/expenses/add/buildAddExpensesPage.js",getState:()=>"/tracker/expenses/add/",getArgs:()=>[{mainContainer:main,manageClient:r,manageUser:s}]}}},notes:{add:{module:"../../layout/user/pages/personal-notes/add/buildAddPersonalNotesPage.js",getState:()=>"/tracker/personal-notes/add/",getArgs:()=>[{mainContainer:main,manageClient:r,manageUser:s}]},edit:{module:"../../layout/user/pages/personal-notes/edit/buildEditPersonalNotesPage.js",getState:()=>"/tracker/personal-notes/edit/",getArgs:()=>[{mainContainer:main,manageClient:r,manageUser:s}]},view:{module:"../page-builders/pages/personal-notes/view/buildViewPersonalNotesPage.js",getState:()=>"/tracker/personal-notes/view/",getArgs:()=>[{mainContainer:main}]}}},l={activeClients:{config:o.clients.active,displayName:"Active Clients"},inactiveClients:{config:o.clients.inactive,displayName:"Inactive Clients"},singleClient:{config:o.clients.single,displayName:"Single Client"},addClient:{config:o.clients.add,displayName:"Add Client"},duplicateClient:{config:o.clients.duplicate,displayName:"Duplicate Client"},deleteDuplicateClient:{config:o.clients.deleteDuplicate,displayName:"Delete Duplicate Client"},addMileage:{config:o.management.mileage.add,displayName:"Add Mileage"},addExpenses:{config:o.management.expenses.add,displayName:"Add Expenses"},editExpenses:{config:o.management.expenses.edit,displayName:"Edit Expenses"},addPersonalNotes:{config:o.notes.add,displayName:"Add Personal Notes"},editPersonalNotes:{config:o.notes.edit,displayName:"Edit Personal Notes"},viewPersonalNotes:{config:o.notes.view,displayName:"View Personal Notes"}};try{isFromServerRenderedPage&&await cleanupServerRenderedListeners(),await cleanupPreviousPage(),n||closeNavigationMenu();const e=document.querySelectorAll(".w3-dropdown-content"),s=document.querySelectorAll(".arrow");e.forEach((e=>e.classList.remove("w3-show"))),s.forEach((e=>e.classList.remove("up")));const r=l[a];if(!r)throw new Error(`Unknown page: ${a}`);const{config:o,displayName:c}=r;await loadNewPage(o,a,t,i)}catch(e){const{displayNavigationError:t}=await import("../components/backupErrorPage.js");t({requestedPage:l[a].displayName||a,errorType:"ImportError"===e.name?"load":"build"});const{AppError:n}=await import("../../errors/models/AppError.js");n.handleError(e,{errorCode:n.Types.RENDER_ERROR,userMessage:null})}}async function cleanupPreviousPage(){cleanup&&(console.log("Clean up Exists: ",cleanup),await cleanup(),cleanup=null)}async function loadNewPage(e,a,t,n){try{const i=await importModule(e.module),s=e.getArgs(t,n);cleanup=await i.default(...s);const r=e.getState(t,n);history.pushState({page:a,isSpaNavigation:!0},"",r),isFromServerRenderedPage=!1}catch(e){throw console.error("Error loading page:",e),e}}async function importModule(e){try{return await import(e)}catch(a){const t=new URL(e,"https://cavalierhorsemanship.com"+"/includes/js/utils/navigation/").pathname,n=await caches.match(t);if(!n)throw a;const i=await n.text(),s=new Blob([i],{type:"application/javascript"}),r=URL.createObjectURL(s);try{const e=await import(r);return URL.revokeObjectURL(r),e}catch(e){throw URL.revokeObjectURL(r),e}}}function cleanupServerRenderedListeners(){const e=["color-options","farrier-prices","date-time","mileage-charges","schedule-options","tracker-install-manager","user-account-page","dashboard","build-invoices-page","build-account-settings-page","unpaid-invoices-modal-listeners"];for(const a of e)hasListeners(a)&&(console.log("Cleaning up listeners for component: ",a),removeListeners(a))}function closeNavigationMenu(){const e=document.querySelectorAll(".drop-menu"),a=document.getElementById("mySidebar");a&&!a.classList.contains("w3-hide")&&a.classList.add("w3-hide"),e?.forEach((e=>{e.nextElementSibling?.classList.remove("w3-show");const a=e.firstElementChild;a?.classList.contains("up")&&a.classList.remove("up")}))}async function checkIfCurrentPageIsServerRendered(){if(history.state&&history.state.isSpaNavigation)return!1;const{ROUTES:e}=await import("../services/trackerAppMainNavigation.js"),a=e||{},t=[];a.static&&Object.values(a.static).forEach((e=>{"object"==typeof e&&Object.values(e).forEach((e=>{"string"==typeof e&&t.push(e)}))}));const n=window.location.pathname;return t.some((e=>n.startsWith(e)))}
// @ts-nocheck
import{removeListeners}from"../../utils/dom/listeners.min.js";let cleanup=null;const main=document.getElementById("main");export default async function selectPage({evt:e,page:t,cID:a=null,closeMenu:n=null,primaryKey:i,manageUser:s,manageClient:l}){e.preventDefault();const r={clients:{active:{module:"../../layout/client/pages/schedule-list/buildAppointmentListPage.min.js",getState:()=>"/tracker/clients/appointments/?active=yes",getArgs:()=>[{active:"yes",mainContainer:main,manageClient:l,manageUser:s}]},inactive:{module:"../../layout/client/pages/schedule-list/buildAppointmentListPage.min.js",getState:()=>"/tracker/clients/appointments/?active=no",getArgs:()=>[{active:"no",mainContainer:main,manageClient:l,manageUser:s}]},single:{module:"../../layout/client/pages/schedule-list/buildAppointmentListPage.min.js",getState:(e,t)=>`/tracker/clients/appointments/?cID=${e}&primaryKey=${t}`,getArgs:(e,t)=>[{mainContainer:main,cID:e,primaryKey:t,manageClient:l,manageUser:s}]},add:{module:"../../layout/client/pages/add-edit-client/buildAddEditClientPage.min.js",getState:()=>"/tracker/clients/add-client/",getArgs:(e,t)=>[{cID:e,primaryKey:t,mainContainer:main,manageClient:l,manageUser:s}]},duplicate:{module:"../../layout/client/pages/duplicate-client/buildDuplicateClientPage.js",getState:()=>"/tracker/clients/duplicate/",getArgs:()=>[{mainContainer:main,manageClient:l,manageUser:s}]},deleteDuplicate:{module:"../../layout/client/pages/delete-duplicate/buildDeleteDuplicateClientPage.js",getState:()=>"/tracker/clients/delete-duplicate/",getArgs:()=>[{mainContainer:main,manageClient:l,manageUser:s}]}},management:{mileage:{module:"../../layout/user/pages/mileage/add/buildAddMileagePage.min.js",getState:()=>"/tracker/mileage/add/",getArgs:()=>[{mainContainer:main,manageClient:l,manageUser:s}]},expenses:{add:{module:"../page-builders/pages/expenses/add/buildAddExpensesPage.js",getState:()=>"/tracker/expenses/add/",getArgs:()=>[{mainContainer:main}]},edit:{module:"../page-builders/pages/expenses/edit/buildEditExpensesPage.js",getState:()=>"/tracker/expenses/edit/",getArgs:()=>[{mainContainer:main}]}}},notes:{add:{module:"../page-builders/pages/personal-notes/add/buildAddPersonalNotesPage.js",getState:()=>"/tracker/personal-notes/add/",getArgs:()=>[{mainContainer:main}]},edit:{module:"../page-builders/pages/personal-notes/edit/buildEditPersonalNotesPage.js",getState:()=>"/tracker/personal-notes/edit/",getArgs:()=>[{mainContainer:main}]},view:{module:"../page-builders/pages/personal-notes/view/buildViewPersonalNotesPage.js",getState:()=>"/tracker/personal-notes/view/",getArgs:()=>[{mainContainer:main}]}}},o={activeClients:{config:r.clients.active,displayName:"Active Clients"},inactiveClients:{config:r.clients.inactive,displayName:"Inactive Clients"},singleClient:{config:r.clients.single,displayName:"Single Client"},addClient:{config:r.clients.add,displayName:"Add Client"},duplicateClient:{config:r.clients.duplicate,displayName:"Duplicate Client"},deleteDuplicateClient:{config:r.clients.deleteDuplicate,displayName:"Delete Duplicate Client"},addMileage:{config:r.management.mileage,displayName:"Add Mileage"},addExpenses:{config:r.management.expenses.add,displayName:"Add Expenses"},editExpenses:{config:r.management.expenses.edit,displayName:"Edit Expenses"},addPersonalNotes:{config:r.notes.add,displayName:"Add Personal Notes"},editPersonalNotes:{config:r.notes.edit,displayName:"Edit Personal Notes"},viewPersonalNotes:{config:r.notes.view,displayName:"View Personal Notes"}};try{cleanupServerRenderedListeners(),await cleanupPreviousPage(),n||closeNavigationMenu();const e=document.querySelectorAll(".w3-dropdown-content"),s=document.querySelectorAll(".arrow");e.forEach((e=>e.classList.remove("w3-show"))),s.forEach((e=>e.classList.remove("up")));const l=o[t];if(!l)throw new Error(`Unknown page: ${t}`);const{config:r,displayName:c}=l;await loadNewPage(r,t,a,i)}catch(e){const{displayNavigationError:a}=await import("../components/backupErrorPage.js");a({requestedPage:o[t].displayName||t,errorType:"ImportError"===e.name?"load":"build"});const{AppError:n}=await import("../../errors/models/AppError.min.js");n.handleError(e,{errorCode:n.Types.RENDER_ERROR,userMessage:null})}}async function cleanupPreviousPage(){cleanup&&(await cleanup(),cleanup=null)}async function loadNewPage(e,t,a,n){try{const i=await importModule(e.module),s=e.getArgs(a,n);cleanup=await i.default(...s);const l=e.getState(a,n);history.pushState({page:t},"",l)}catch(e){throw console.error("Error loading page:",e),e}}async function importModule(e){try{return await import(e)}catch(t){const a=new URL(e,"https://cavalierhorsemanship.com"+"/includes/js/utils/navigation/").pathname,n=await caches.match(a);if(!n)throw t;const i=await n.text(),s=new Blob([i],{type:"application/javascript"}),l=URL.createObjectURL(s);try{const e=await import(l);return URL.revokeObjectURL(l),e}catch(e){throw URL.revokeObjectURL(l),e}}}function cleanupServerRenderedListeners(){removeListeners("color-options"),removeListeners("farrier-prices"),removeListeners("date-time"),removeListeners("mileage-charges"),removeListeners("schedule-options")}function closeNavigationMenu(){const e=document.querySelectorAll(".drop-menu"),t=document.getElementById("mySidebar");t?.classList.contains("w3-show")&&(t.classList.remove("w3-show"),t.classList.add("w3-hide")),e?.forEach((e=>{e.nextElementSibling?.classList.remove("w3-show");const t=e.firstElementChild;t?.classList.contains("up")&&t.classList.remove("up")}))}
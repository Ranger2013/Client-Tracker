// @ts-nocheck
import{getReadableCurrentFutureDate}from"../../../../../utils/date/dateUtils.js";import{buildElementsFromConfig}from"../../../../../utils/dom/elements.js";import{removeListeners}from"../../../../../utils/dom/listeners.js";import{clearMsg}from"../../../../../utils/dom/messages.js";import{cleanUserOutput}from"../../../../../utils/string/stringUtils.js";import buildFuelChargeCheckboxSection from"../../../../components/buildFuelChargeCheckboxSection.js";import buildInvoicePaidCheckbox from"../../../../components/buildInvoicePageCheckbox.js";import buildPageContainer from"../../../../components/buildPageContainer.js";import buildSessionNotesSection from"../../../../components/buildSessionNotesSection.js";import buildSubmitButtonSection from"../../../../components/buildSubmitButtonSection.js";import buildTwoColumnInputSection from"../../../../components/buildTwoColumnInputSection.js";import getMileageCharges from"./components/getMileageCharges.js";const COMPONENT_ID="add-trimming";export default async function buildAddTrimmingPage({cID:e,primaryKey:t,mainContainer:i,manageUser:n,manageClient:a}){try{if(clearMsg({container:"page-msg"}),!e||!t)throw new Error("Unable to build the add trimming page. Certain parameters are missing.");const r=await n.getMileageCharges(),o=await a.getClientInfo({primaryKey:t}),m=cleanUserOutput(o.client_name)||"No Name Found",s=o?.horses||[],l=o?.distance||0;if(0===s.length){buildNoHorsePage({cID:e,primaryKey:t,mainContainer:i});const{default:r}=await import("../../../../../../features/client/ui/add-trimming/addTrimmingJS.js");return r({cID:e,primaryKey:t,mainContainer:i,manageClient:a,manageUser:n,componentId:COMPONENT_ID}),()=>removeListeners(COMPONENT_ID)}const d=parseInt(o.trim_cycle,10)/7,u=buildElementsFromConfig({trimmingForm:{type:"form",attributes:{id:"trimming-form"}},numberHorseContainer:{type:"div",attributes:{id:"number-horse-container"},myClass:["w3-padding-small"]},trimCycleNoteContainer:{type:"div",myClass:["w3-small","w3-text-red"],text:`Note: This client's trimming cycle is set to ${d} weeks.`}});let p,c;if(o?.email){const{default:e}=await import("../../../../components/buildReceiptSection.js");p=await e()}const{inRange:g,cost:C}=getMileageCharges({clientDistance:l,mileageCharges:r});g&&(c=await buildFuelChargeCheckboxSection(C));const[[b,y],h,T,f,I,N,w,S,D]=await Promise.all([buildPageContainer({pageTitle:"Add Trimming for ",clientName:m,cID:e,primaryKey:t}),buildTwoColumnInputSection({labelText:"Number of Horses:",inputType:"number",inputID:"number-horses",inputName:"number_horses",inputTitle:"Number of Horses",required:!0}),buildTwoColumnInputSection({labelText:"Trim Date:",inputType:"date",inputID:"trim-date",inputName:"trim_date",inputTitle:"Trim Date",required:!0,additionalElement:u.trimCycleNoteContainer}),buildTwoColumnInputSection({labelText:"Next Trimming/Shoeing Date:",inputType:"date",inputID:"next-trim-date",inputName:"next_trim_date",inputTitle:"Next Trim Date",required:!0,inputValue:getReadableCurrentFutureDate(o?.trim_cycle)}),buildTwoColumnInputSection({labelText:"Appointment Time:",inputType:"time",inputID:"app-time",inputName:"app_time",inputTitle:"Appointment Time",required:!0,inputValue:o?.app_time}),buildSessionNotesSection(),buildTwoColumnInputSection({labelText:"Amount Due:",inputType:"number",inputID:"payment",inputName:"payment",inputTitle:"Payment",required:!0}),buildInvoicePaidCheckbox(),buildSubmitButtonSection("Add Trimming/Shoeing")]);y.appendChild(u.trimmingForm),u.trimmingForm.append(h,u.numberHorseContainer,T,f,I),p instanceof HTMLElement&&u.trimmingForm.appendChild(p),c instanceof HTMLElement&&u.trimmingForm.appendChild(c),u.trimmingForm.append(N,w,S,D),b.appendChild(y),i.innerHTML="",i.appendChild(b);const{default:x}=await import("../../../../../../features/client/ui/add-trimming/addTrimmingJS.js");return x({cID:e,primaryKey:t,mainContainer:i,manageClient:a,manageUser:n,componentId:COMPONENT_ID}),()=>removeListeners(COMPONENT_ID)}catch(e){throw e}}function buildNoHorsePage({cID:e,primaryKey:t,mainContainer:i}){try{const n=buildElementsFromConfig({container:{type:"div",myClass:["w3-center"]},card:{type:"div",myClass:["w3-card"],attributes:{id:"card"}},notice:{type:"h4",myClass:["w3-text-red"],text:"This client does not have any horses Listed."},linkContainer:{type:"p",myClass:["w3-margin-top","w3-padding-small"],text:"Please "},link:{type:"a",attributes:{id:"add-horse-link",href:`/tracker/client-horses/add/?cID=${e}&primaryKey=${t}`,title:"Add a Horse","data-add-horse-navigation:":!0},myClass:["w3-text-blue"],text:"add a horse"}}),{container:a,card:r,notice:o,linkContainer:m,link:s}=n;m.appendChild(s),r.append(o,m),a.appendChild(r),i.innerHTML="",i.appendChild(n.container)}catch(e){throw e}}
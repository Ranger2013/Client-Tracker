// @ts-nocheck
// @ts-nocheck
// @ts-nocheck
// @ts-nocheck
// @ts-nocheck
// @ts-nocheck
// @ts-nocheck
// @ts-nocheck
// @ts-nocheck
// @ts-nocheck
// @ts-nocheck
// @ts-nocheck
// @ts-nocheck
// @ts-nocheck
import{formatDate,formatTime,getSMSWeekday}from"../../../../../utils/date/dateUtils.js";import{buildEle,buildElementsFromConfig}from"../../../../../utils/dom/elements.js";import{cleanUserOutput}from"../../../../../utils/string/stringUtils.js";const isFutureDate=t=>{var e=new Date,a=new Date(t+"T00:00").getTime()-e.getTime();return Math.ceil(a/864e5)};export default async function buildClientListRow({client:t,index:e,colorOptions:a,dateTime:r}){try{const i=getScheduleColorOptions({trimDate:t.trim_date,colorOptions:a}),n=buildClientAnchor({client:t}),o=buildClientAddress({client:t}),l=buildClientTrimDate({client:t,dateTime:r}),s=buildClientMenu({client:t,index:e}),d=new Date(t.trim_date+"T00:00").toLocaleString("en-US",{weekday:"long"}).toLowerCase(),c=buildEle({type:"div",attributes:{id:`client-list-block-${e+1}`,style:i},myClass:["w3-row","w3-padding-small","w3-border-left","w3-border-right","w3-border-bottom"]});return[{myClass:["w3-col","m2","s4","w3-center"],content:n,searchable:{type:"client-name",value:cleanUserOutput(t.client_name)}},{myClass:["w3-col","m2","w3-center","w3-hide-small"],content:o,searchable:{type:"address",value:`${cleanUserOutput(t.street)} ${cleanUserOutput(t.city)} ${cleanUserOutput(t.state)}`}},{myClass:["w3-col","m2","w3-center","w3-hide-small"],content:cleanUserOutput(t.phone),searchable:{type:"phone",value:cleanUserOutput(t.phone)}},{myClass:["w3-col","m2","w3-center","w3-hide-small"],content:cleanUserOutput(formatTime(t.app_time,r.time_format)),searchable:{type:"app-time",value:cleanUserOutput(t.app_time)}},{myClass:["w3-col","m2","s4","w3-center"],content:l,searchable:{type:"app-date",value:`${t.trim_date} ${d}`}},{myClass:["w3-col","m2","s4","w3-center","w3-margin-top"],content:s}].forEach((t=>{const e=buildEle({type:"div",myClass:t.myClass,text:t.content,attributes:t.searchable?{"data-search-type":t.searchable.type,"data-search-value":t.searchable.value}:void 0});c.appendChild(e)})),c}catch(t){const{AppError:e}=await import("../../../../../errors/models/AppError.js");e.process(t,{errorCode:e.Types.RENDER_ERROR,userMessage:e.BaseMessages.system.render},!0)}}function getScheduleColorOptions({trimDate:t,colorOptions:e}){try{const a=isFutureDate(t),r=`color: ${e?.text_color}`;let i;switch(!0){case a>=7:i=e?.color_7;break;case a>=3:i=e?.color_6_3;break;case 2===a:i=e?.color_2;break;case 1===a:i=e?.color_tomorrow;break;case 0===a:i=e?.color_today;break;default:i=e?.over_due}return`background-color:${i}; ${r}`}catch(t){throw t}}function buildClientAnchor({client:t}){try{return buildEle({type:"a",attributes:{href:`sms://${cleanUserOutput(t.phone)}`,title:`Text ${cleanUserOutput(t.client_name)}`},text:cleanUserOutput(t.client_name)})}catch(t){throw t}}function buildClientAddress({client:t}){try{let e=`${cleanUserOutput(t.street)},<br>${cleanUserOutput(t.city)}, ${cleanUserOutput(t.state)}`;return e+=t.zip&&""!==t.zip?`, ${cleanUserOutput(t.zip)}`:"",e}catch(t){throw t}}function buildClientTrimDate({client:t,dateTime:e}){try{const a=new Date(t.trim_date+"T00:00").toLocaleDateString("en-US",{weekday:"long"}),r=buildEle({type:"div"}),i=buildEle({type:"div",text:a}),n=buildEle({type:"span",myClass:["app-date"],text:cleanUserOutput(formatDate(t.trim_date,e))}),o=buildEle({type:"div",myClass:["w3-hide-medium","w3-hide-large"],text:`At ${formatTime(t.app_time,e.time_format)}`});return r.append(i,n,o),r}catch(t){throw t}}function buildClientMenu({client:t,index:e}){try{const a=getSMSWeekday(t.trim_date),r=formatTime(t.app_time,12),i=encodeURI(`${t.street},${t.city},${t.state}`),n=(t.cID,t.primaryKey,new Date),o=new Date(n);o.setDate(n.getDate()+1);const[l,s,d]=t.trim_date.split("-").map(Number),c=new Date(l,s-1,d),m=o.toLocaleDateString("en-US"),p=`Wanting to confirm your farrier appointment for ${c.toLocaleDateString("en-US")===m?"tomorrow":a} at ${r}.`,u={container:{type:"div",myClass:["w3-dropdown-click"]},menuButton:{type:"button",attributes:{"data-action":"manage-client","data-client-id":t.cID,"data-primary-key":t.primaryKey,"data-target":`button-${e+1}`},myClass:["w3-button","w3-padding-small","w3-round-large","w3-dark-grey","w3-text-white","w3-small"],text:"Manage Client"},menuContent:{type:"div",attributes:{id:`button-${e+1}`,style:"right: 0px; width: 200px;"},myClass:["w3-dropdown-content","w3-bar-block","w3-border","w3-border-white"]},confirm:{type:"a",attributes:{href:`sms://${cleanUserOutput(t.phone)}?&body=${p}`},myClass:["w3-border-bottom","w3-border-white","w3-bar-item","w3-button","w3-text-white","w3-dark-grey"],text:"Confirm Appointment"},directions:{type:"a",attributes:{href:`https://maps.google.com/maps?q=${i}`,target:"_blank"},myClass:["w3-border-bottom","w3-border-white","w3-bar-item","w3-button","w3-text-white","w3-dark-grey","w3-hide-large"],text:"Directions"},call:{type:"a",attributes:{href:`tel:${cleanUserOutput(t.phone)}`},myClass:["w3-border-bottom","w3-border-white","w3-bar-item","w3-button","w3-text-white","w3-dark-grey","w3-hide-large"],text:"Call"},editClient:{type:"a",attributes:{href:`/tracker/clients/edit-client/?cID=${t.cID}&key=${t.primaryKey}`,"data-page":"edit-client","data-clientid":t.cID,"data-primarykey":t.primaryKey},myClass:["w3-border-bottom","w3-border-white","w3-bar-item","w3-button","w3-text-white","w3-black"],text:"Edit Client"}},w={trimming:{id:`trims-${e+1}`,cID:t.cID,primaryKey:t.primaryKey,buttonText:"Trimming/Shoeing",pages:{add:{href:{address:`../../trimming/add/?cID=${t.cID}&key=${t.primaryKey}`,text:"Add Trim/Shoeing"},dataPage:{"data-page":"add-trimming","data-clientid":t.cID,"data-primarykey":t.primaryKey},pageName:"add-trimming"},view:{href:{address:`../../trimming/view/?cID=${t.cID}&key=${t.primaryKey}`,text:"View Dates"},dataPage:{"data-page":"view-trim-dates","data-clientid":t.cID,"data-primarykey":t.primaryKey},pageName:"view-trim-dates"}}},clientHorses:{id:`horses-${e+1}`,cID:t.cID,primaryKey:t.primaryKey,buttonText:"Client Horses",pages:{add:{href:{address:`../../client-horses/add/?cID=${t.cID}&key=${t.primaryKey}`,text:"Add Horse"},dataPage:{"data-page":"add-horse","data-clientid":t.cID,"data-primarykey":t.primaryKey},pageName:"add-horse"},edit:{href:{address:`../../client-horses/edit/?cID=${t.cID}&key=${t.primaryKey}`,text:"Edit Horse"},dataPage:{"data-page":"edit-horse","data-clientid":t.cID,"data-primarykey":t.primaryKey},pageName:"edit-horse"}}}},y=document.createDocumentFragment(),{container:b,menuButton:h,menuContent:g,confirm:C,directions:D,call:f,editClient:$}=buildElementsFromConfig(u),x=buildDropDownMenuConfig(w);return y.appendChild(b),b.append(h,g),g.append(C,D,f),g.append(x,$),y}catch(t){throw t}}function buildDropDownMenuConfig(t){try{const e=document.createDocumentFragment();return Object.keys(t).forEach((a=>{t[a].cID,t[a].primaryKey;const r=t[a].id,i=buildEle({type:"div",myClass:["w3-dropdown-click"]}),n=buildEle({type:"button",attributes:{"data-action":"manage-client","data-target":r},myClass:["w3-button","w3-border-bottom","w3-border-white","w3-text-white","w3-padding-small","w3-black"],text:`<span class="arrow">\n\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="10" height="8" viewBox="0 0 10 10">\n\t\t\t\t\t\t<polygon points="0,0 10,0 5,10" fill="white" />\n\t\t\t\t\t</svg>\n\t\t\t\t</span>&nbsp;${t[a].buttonText}`}),o=buildEle({type:"div",attributes:{id:r,style:"position: relative"},myClass:["w3-dropdown-content","w3-bar-block","w3-blue-grey"]}),l=t[a].pages,s=Object.keys(l).map((t=>{const e=l[t].href.address,a=l[t].href.text,r=(l[t].pageName,l[t].dataPage);return buildEle({type:"a",attributes:{href:e,...r},myClass:["w3-border-bottom","w3-bar-item","w3-button","w3-text-white"],text:a})}));o.append(...s),i.append(n,o),e.appendChild(i)})),e}catch(t){throw t}}
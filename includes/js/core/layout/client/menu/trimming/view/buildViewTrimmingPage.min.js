// @ts-nocheck
import{formatDate,getWeeksAndDaysSinceLastTrim,sortByDateOnly}from"../../../../../utils/date/dateUtils";import{buildEle}from"../../../../../utils/dom/elements";import{cleanUserOutput,ucwords,underscoreToSpaces}from"../../../../../utils/string/stringUtils";import buildPageContainer from"../../../../components/buildPageContainer";const COMPONENT="Build View Trimming Page",DEBUG=!1,debugLog=(...e)=>{false};export default async function buildViewTrimmingPage({cID:e,primaryKey:t,mainContainer:a,manageClient:i,manageUser:l}){try{if(!e||!t)throw new Error("Unable to build the View Trim/Shoeing Dates. Not all data was provided.");const{date_format:s,time_format:r}=await l.getDateTimeOptions,{client_name:d}=await i.getClientInfo({primaryKey:t}),n=(await i.getClientTrimmingInfo(e)).slice(-3),m=e=>{const t=buildEle({type:e.type,myClass:e.myClass,text:e.text});return e.children&&Object.values(e.children).forEach((e=>{t.appendChild(m(e))})),t},o={root:{type:"div",myClass:["w3-row","w3-light-grey","w3-border-bottom","w3-border-top"],children:{colOne:{type:"div",myClass:["w3-col","s4","w3-padding-small"],children:{large:{type:"div",myClass:["w3-hide-small","w3-center","w3-bold"],text:"Trim Dates"},small:{type:"div",myClass:["w3-hide-medium","w3-hide-large","w3-center","w3-bold"],text:"Dates"}}},colTwo:{type:"div",myClass:["w3-col","s4","w3-padding-small"],children:{large:{type:"div",myClass:["w3-hide-small","w3-center"],text:"Type Service/Cost"},small:{type:"div",myClass:["w3-hide-medium","w3-hide-large","w3-center"],text:"# Horses"}}},colThree:{type:"div",myClass:["w3-col","s4","w3-padding-small"],children:{large:{type:"div",myClass:["w3-center","w3-bold"],text:"Payments"}}}}}},[c,y]=await buildPageContainer({pageTitle:"View Trimming Dates for ",clientName:d,cID:e,primaryKey:t}),p={root:{type:"div",myClass:["w3-margin-top","w3-padding-small","w3-center"],children:{anchor:{type:"a",myClass:["w3-underline"],attributes:{href:"/tracker/trimming/view/?all=true"},text:"View All Trimming Dates"}}}},w=document.createDocumentFragment();n.sort(((e,t)=>sortByDateOnly(e.date_trimmed,t.date_trimmed,!1))).forEach((e=>{const{cID:t,date_trimmed:a,horses:i,mileage_cost:l,paid:r,payment_amount:d,session_notes:n}=e,{weeks:o,days:c}=getWeeksAndDaysSinceLastTrim(a),y={root:{type:"div",myClass:["w3-row","w3-border-bottom","w3-padding-small"],children:{colOne:{type:"div",myClass:["w3-col","s4"],children:{large:{type:"div",myClass:["w3-hide-small","w3-center"],children:{date:{type:"div",text:formatDate(a,s)},timeAgo:{type:"span",myClass:["w3-small"],text:`${o} weeks and ${c} day(s) ago`}}},small:{type:"div",myClass:["w3-hide-medium","w3-hide-large","w3-center"],text:formatDate(a,s)}}},colTwo:{type:"div",myClass:["w3-col","s4"],children:{large:{type:"div",myClass:["w3-hide-small","w3-center"],children:i.reduce(((e,t)=>{const[a,i]=t.type_trim.split(":"),l=cleanUserOutput(t.horse_name),s=ucwords(underscoreToSpaces(a));return{...e,[`horse_${t.hID}`]:{type:"div",children:{name:{type:"span",myClass:["w3-bold","w3-underline"],text:l},lineBreak:{type:"br"},service:{type:"span",myClass:["w3-small","indent"],text:`${s}: $${i}`},...t.acc?.length&&t.acc.map(((e,t)=>{const[a,i,l]=e.split(":");return{[`accBreak_${t}`]:{type:"br"},[`acc_${t}`]:{type:"span",myClass:["w3-small","indent"],text:`${ucwords(underscoreToSpaces(i))}: $${l}`}}})).reduce(((e,t)=>({...e,...t})),{})}}}}),{})},small:{type:"div",myClass:["w3-hide-medium","w3-hide-large","w3-center"],text:i.length}}},colThree:{type:"div",myClass:["w3-col","s4"],children:{large:{type:"div",myClass:["w3-center"],children:{mileage:{type:"div",text:`Mileage: $${l||"0.00"}`},total:{type:"div",text:`Total: $${d}`},status:{type:"div",myClass:["yes"===r?"w3-text-green":"w3-text-red"],text:"yes"===r?"Paid":"Unpaid"}}}}}}}},p=m(y.root);w.appendChild(p)}));const g=m(o.root),h=m(p.root);y.appendChild(g),y.append(w,h),c.appendChild(y),a.innerHTML="",a.appendChild(c)}catch(e){throw e}}
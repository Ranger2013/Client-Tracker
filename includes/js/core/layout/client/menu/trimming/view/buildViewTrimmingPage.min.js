// @ts-nocheck
import{formatDate,getWeeksAndDaysSinceLastTrim,sortByDateOnly}from"../../../../../utils/date/dateUtils.min.js";import{buildEle,buildElementTree}from"../../../../../utils/dom/elements.min.js";import{buildPageContainer}from"../../../../../utils/dom/forms/buildUtils.min.js";import{removeListeners}from"../../../../../utils/dom/listeners.min.js";import{cleanUserOutput,ucwords,underscoreToSpaces}from"../../../../../utils/string/stringUtils.min.js";const COMPONENT_ID="buildViewTrimmingPage",COMPONENT="Build View Trimming Page",DEBUG=!1,debugLog=(...e)=>{false};export default async function buildViewTrimmingPage({cID:e,primaryKey:t,mainContainer:i,manageClient:a,manageUser:r}){try{if(!e||!t)throw new Error("Unable to build the View Trim/Shoeing Dates. Not all data was provided.");const{date_format:s,time_format:l}=await r.getDateTimeOptions,{client_name:n}=await a.getClientInfo({primaryKey:t}),m=(await a.getClientTrimmingInfo(e)).slice(-3),d={root:{type:"div",myClass:["w3-row","w3-light-grey","w3-border-bottom","w3-border-top"],children:{colOne:{type:"div",myClass:["w3-col","s4","w3-padding-small"],children:{large:{type:"div",myClass:["w3-hide-small","w3-center","w3-bold"],text:"Trim Dates"},small:{type:"div",myClass:["w3-hide-medium","w3-hide-large","w3-center","w3-bold"],text:"Dates"}}},colTwo:{type:"div",myClass:["w3-col","s4","w3-padding-small"],children:{large:{type:"div",myClass:["w3-hide-small","w3-center"],text:"Type Service/Cost"},small:{type:"div",myClass:["w3-hide-medium","w3-hide-large","w3-center"],text:"# Horses"}}},colThree:{type:"div",myClass:["w3-col","s4","w3-padding-small"],children:{large:{type:"div",myClass:["w3-center","w3-bold"],text:"Payments"}}}}}},[o,c]=await buildPageContainer({pageTitle:"View Trimming Dates for ",clientName:n,cID:e,primaryKey:t}),y={root:{type:"div",myClass:["w3-margin-top","w3-padding-small","w3-center"],children:{anchor:{type:"a",myClass:["w3-underline"],attributes:{href:"/tracker/trimming/view/?all=true"},text:"View All Trimming Dates"}}}},p=document.createDocumentFragment();m.sort(((e,t)=>sortByDateOnly(e.date_trimmed,t.date_trimmed,!1))).forEach((e=>{const{cID:t,date_trimmed:i,horses:a,mileage_cost:r,paid:l,payment_amount:n,session_notes:m}=e,{weeks:d,days:o}=getWeeksAndDaysSinceLastTrim(i),c={root:{type:"div",myClass:["w3-row","w3-border-bottom","w3-padding-small"],children:{colOne:{type:"div",myClass:["w3-col","s4"],children:{large:{type:"div",myClass:["w3-hide-small","w3-center"],children:{date:{type:"div",text:formatDate(i,s)},timeAgo:{type:"span",myClass:["w3-small"],text:`${d} weeks and ${o} day(s) ago`}}},small:{type:"div",myClass:["w3-hide-medium","w3-hide-large","w3-center"],text:formatDate(i,s)}}},colTwo:{type:"div",myClass:["w3-col","s4"],children:{large:{type:"div",myClass:["w3-hide-small","w3-center"],children:a.reduce(((e,t)=>{const[i,a]=t.type_trim.split(":"),r=cleanUserOutput(t.horse_name),s=ucwords(underscoreToSpaces(i));return{...e,[`horse_${t.hID}`]:{type:"div",children:{name:{type:"span",myClass:["w3-bold","w3-underline"],text:r},lineBreak:{type:"br"},service:{type:"span",myClass:["w3-small","indent"],text:`${s}: $${a}`},...t.acc?.length&&t.acc.map(((e,t)=>{const[i,a,r]=e.split(":");return{[`accBreak_${t}`]:{type:"br"},[`acc_${t}`]:{type:"span",myClass:["w3-small","indent"],text:`${ucwords(underscoreToSpaces(a))}: $${r}`}}})).reduce(((e,t)=>({...e,...t})),{})}}}}),{})},small:{type:"div",myClass:["w3-hide-medium","w3-hide-large","w3-center"],text:a.length}}},colThree:{type:"div",myClass:["w3-col","s4"],children:{large:{type:"div",myClass:["w3-center"],children:{mileage:{type:"div",text:`Mileage: $${r||"0.00"}`},total:{type:"div",text:`Total: $${n}`},status:{type:"div",myClass:["yes"===l?"w3-text-green":"w3-text-red"],text:"yes"===l?"Paid":"Unpaid"}}}}}}}},y=buildElementTree(c.root);p.appendChild(y)}));const w=buildElementTree(d.root),g=buildElementTree(y.root);c.appendChild(w),c.append(p,g),o.appendChild(c),i.innerHTML="",i.appendChild(o);const{default:u}=await import("../../../../../../features/client/ui/view-trimming/viewTrimmingJS");return u({cID:e,primaryKey:t,mainContainer:i,manageClient:a,manageUser:r,componentId:COMPONENT_ID}),()=>removeListeners(COMPONENT_ID)}catch(e){throw e}}
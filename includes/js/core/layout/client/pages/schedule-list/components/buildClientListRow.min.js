// @ts-nocheck
import{formatDate,formatTime,getSMSWeekday}from"../../../../../utils/date/dateUtils.js";import{buildEle,buildElementsFromConfig}from"../../../../../utils/dom/elements.js";import{cleanUserOutput}from"../../../../../utils/string/stringUtils.js";const isFutureDate=t=>{var e=new Date,r=new Date(t+"T00:00").getTime()-e.getTime();return Math.ceil(r/864e5)};export default async function buildClientListRow({client:t,index:e,colorOptions:r,dateTime:a}){try{const i=getScheduleColorOptions({trimDate:t.trim_date,colorOptions:r}),n=buildClientAnchor({client:t}),o=buildClientAddress({client:t}),s=buildClientTrimDate({client:t,dateTime:a}),l=buildClientMenu({client:t,index:e}),c=new Date(t.trim_date+"T00:00").toLocaleString("en-US",{weekday:"long"}).toLowerCase(),d=buildEle({type:"div",attributes:{id:`client-list-block-${e+1}`,style:i},myClass:["w3-row","w3-padding-small","w3-border-left","w3-border-right","w3-border-bottom"]});return[{myClass:["w3-col","m2","s4","w3-center"],content:n,searchable:{type:"client-name",value:cleanUserOutput(t.client_name)}},{myClass:["w3-col","m2","w3-center","w3-hide-small"],content:o,searchable:{type:"address",value:`${cleanUserOutput(t.street)} ${cleanUserOutput(t.city)} ${cleanUserOutput(t.state)}`}},{myClass:["w3-col","m2","w3-center","w3-hide-small"],content:cleanUserOutput(t.phone),searchable:{type:"phone",value:cleanUserOutput(t.phone)}},{myClass:["w3-col","m2","w3-center","w3-hide-small"],content:cleanUserOutput(formatTime(t.app_time,a.time_format)),searchable:{type:"app-time",value:cleanUserOutput(t.app_time)}},{myClass:["w3-col","m2","s4","w3-center"],content:s,searchable:{type:"app-date",value:`${t.trim_date} ${c}`}},{myClass:["w3-col","m2","s4","w3-center","w3-margin-top"],content:l}].forEach((t=>{const e=buildEle({type:"div",myClass:t.myClass,text:t.content,attributes:t.searchable?{"data-search-type":t.searchable.type,"data-search-value":t.searchable.value}:void 0});d.appendChild(e)})),d}catch(t){const{AppError:e}=await import("../../../../../errors/models/AppError.js");e.process(t,{errorCode:e.Types.RENDER_ERROR,userMessage:e.BaseMessages.system.render},!0)}}function getScheduleColorOptions({trimDate:t,colorOptions:e}){try{const r=isFutureDate(t),a=`color: ${e?.text_color}`;let i;switch(!0){case r>=7:i=e?.color_7;break;case r>=3:i=e?.color_6_3;break;case 2===r:i=e?.color_2;break;case 1===r:i=e?.color_tomorrow;break;case 0===r:i=e?.color_today;break;default:i=e?.over_due}return`background-color:${i}; ${a}`}catch(t){throw t}}function buildClientAnchor({client:t}){try{return buildEle({type:"a",attributes:{href:`sms://${cleanUserOutput(t.phone)}`,title:`Text ${cleanUserOutput(t.client_name)}`},text:cleanUserOutput(t.client_name)})}catch(t){throw t}}function buildClientAddress({client:t}){try{let e=`${cleanUserOutput(t.street)},<br>${cleanUserOutput(t.city)}, ${cleanUserOutput(t.state)}`;return e+=t.zip&&""!==t.zip?`, ${cleanUserOutput(t.zip)}`:"",e}catch(t){throw t}}function buildClientTrimDate({client:t,dateTime:e}){try{const r=new Date(t.trim_date+"T00:00").toLocaleDateString("en-US",{weekday:"long"}),a=buildEle({type:"div"}),i=buildEle({type:"div",text:r}),n=buildEle({type:"span",myClass:["app-date"],text:cleanUserOutput(formatDate(t.trim_date,e))}),o=buildEle({type:"div",myClass:["w3-hide-medium","w3-hide-large"],text:`At ${formatTime(t.app_time,e.time_format)}`});return a.append(i,n,o),a}catch(t){throw t}}function buildClientMenu({client:t,index:e}){try{const r=getSMSWeekday(t.trim_date),a=formatTime(t.app_time,12),i=encodeURI(`${t.street},${t.city},${t.state}`),n=(t.cID,t.primaryKey,new Date),o=new Date(n);o.setDate(n.getDate()+1);const[s,l,c]=t.trim_date.split("-").map(Number),d=new Date(s,l-1,c),m=o.toLocaleDateString("en-US"),p=`Wanting to confirm your farrier appointment for ${d.toLocaleDateString("en-US")===m?"tomorrow":r} at ${a}.`,u={container:{type:"div",myClass:["w3-dropdown-click"]},menuButton:{type:"button",attributes:{"data-action":"manage-client","data-client-id":t.cID,"data-primary-key":t.primaryKey,"data-target":`button-${e+1}`},myClass:["w3-button","w3-padding-small","w3-round-large","w3-dark-grey","w3-text-white","w3-small"],text:"Manage Client"},menuContent:{type:"div",attributes:{id:`button-${e+1}`,style:"right: 0px; width: 200px;"},myClass:["w3-dropdown-content","w3-bar-block","w3-border","w3-border-white"]},confirm:{type:"a",attributes:{href:`sms://${cleanUserOutput(t.phone)}?&body=${p}`},myClass:["w3-border-bottom","w3-border-white","w3-bar-item","w3-button","w3-text-white","w3-dark-grey"],text:"Confirm Appointment"},directions:{type:"a",attributes:{href:`https://maps.google.com/maps?q=${i}`,target:"_blank"},myClass:["w3-border-bottom","w3-border-white","w3-bar-item","w3-button","w3-text-white","w3-dark-grey","w3-hide-large"],text:"Directions"},call:{type:"a",attributes:{href:`tel:${cleanUserOutput(t.phone)}`},myClass:["w3-border-bottom","w3-border-white","w3-bar-item","w3-button","w3-text-white","w3-dark-grey","w3-hide-large"],text:"Call"},editClient:{type:"a",attributes:{href:`/tracker/clients/edit-client/?cID=${t.cID}&key=${t.primaryKey}`},myClass:["w3-border-bottom","w3-border-white","w3-bar-item","w3-button","w3-text-white","w3-black"],text:"Edit Client"}},w={trimming:{id:`trims-${e+1}`,cID:t.cID,primaryKey:t.primaryKey,buttonText:"Trimming/Shoeing",pages:{add:{href:{address:`../../trimming/add/?cID=${t.cID}&key=${t.primaryKey}`,text:"Add Trim/Shoeing"},pageName:"add-trimming"},view:{href:{address:`../../trimming/view/?cID=${t.cID}&key=${t.primaryKey}`,text:"View Dates"},pageName:"view-trim-dates"}}},clientHorses:{id:`horses-${e+1}`,cID:t.cID,primaryKey:t.primaryKey,buttonText:"Client Horses",pages:{add:{href:{address:`../../client-horses/add/?cID=${t.cID}&key=${t.primaryKey}`,text:"Add Horse"},pageName:"add-horse"},edit:{href:{address:`../../client-horses/edit/?cID=${t.cID}&key=${t.primaryKey}`,text:"Edit Horse"},pageName:"edit-horse"}}}},y=document.createDocumentFragment(),{container:b,menuButton:h,menuContent:g,confirm:C,directions:f,call:D,editClient:$}=buildElementsFromConfig(u),x=buildDropDownMenuConfig(w);return y.appendChild(b),b.append(h,g),g.append(C,f,D),g.append(x,$),y}catch(t){throw t}}function buildDropDownMenuConfig(t){try{const e=document.createDocumentFragment();return Object.keys(t).forEach((r=>{t[r].cID,t[r].primaryKey;const a=t[r].id,i=buildEle({type:"div",myClass:["w3-dropdown-click"]}),n=buildEle({type:"button",attributes:{"data-action":"manage-client","data-target":a},myClass:["w3-button","w3-border-bottom","w3-border-white","w3-text-white","w3-padding-small","w3-black"],text:`<span class="arrow">\n\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="10" height="8" viewBox="0 0 10 10">\n\t\t\t\t\t\t<polygon points="0,0 10,0 5,10" fill="white" />\n\t\t\t\t\t</svg>\n\t\t\t\t</span>&nbsp;${t[r].buttonText}`}),o=buildEle({type:"div",attributes:{id:a,style:"position: relative"},myClass:["w3-dropdown-content","w3-bar-block","w3-blue-grey"]}),s=t[r].pages,l=Object.keys(s).map((t=>{const e=s[t].href.address,r=s[t].href.text;s[t].pageName;return buildEle({type:"a",attributes:{href:e},myClass:["w3-border-bottom","w3-bar-item","w3-button","w3-text-white"],text:r})}));o.append(...l),i.append(n,o),e.appendChild(i)})),e}catch(t){throw t}}
// @ts-nocheck
import{buildEle,buildElementsFromConfig,getValidElement}from"../../../../../utils/dom/elements.js";import createSelectElement from"../../../../../utils/dom/forms/createSelectElement.js";import{removeListeners}from"../../../../../utils/dom/listeners.js";import buildHorseTypesWidget from"./components/buildHorseTypesWidget.js";import buildOverviewWidget from"./components/buildOverviewWidget.js";const COMPONENT="Client Stats Page",DEBUG=!1,debugLog=(...e)=>{false},COMPONENT_ID="build-client-stats-page";export default async function buildClientStatsPage({tabContentContainer:e,manageClient:t,manageUser:n,componentId:o}){const i=await t.getClientScheduleList();if(debugLog(),!i?.length){return void renderNoClientPage({tabContainer:e,pageComponent:buildNoClientsComponent()})}renderPage({tabContainer:e,pageComponent:buildPageComponents(),widgets:buildWidgets({clientData:i,componentId:o})});const{default:a}=await import("../../../../../../features/user/ui/my-account/user-account/tabs/client-stats/clientStatsJS.js");return await a({tabContentContainer:e,componentId:COMPONENT_ID,manageUser:n,manageClient:t}),()=>removeListeners(COMPONENT_ID)}function buildPageComponents(){const e=buildElementsFromConfig({container:{type:"div",myClass:["w3-padding-small","w3-border-bottom","w3-border-gray"]},tabBarContainer:{type:"div",myClass:["w3-center"]},overviewContainer:{type:"div",attributes:{id:"overview-container"},myClass:["w3-padding-small"]},horseTypesContainer:{type:"div",attributes:{id:"horse-types-container"},myClass:["w3-padding-small","w3-hide"]}}),t=buildEle({type:"div",myClass:["w3-bar","w3-round-large","w3-card"],attributes:{id:"tab-bar-container",style:"display: inline-block; overflow: hidden;"}});return[{value:"overview",text:"Overview"},{value:"horse-types",text:"Horse Types"}].forEach(((e,n)=>{const o=buildEle({type:"button",myClass:0===n?["w3-bar-item","w3-button","w3-blue-grey"]:["w3-bar-item","w3-button"],attributes:{"data-widget":e.value,style:"minWidth: 70px;"},text:e.text});t.appendChild(o)})),e.tabBarContainer.appendChild(t),e}function buildWidgets({clientData:e,componentId:t}){const n=processClientData(e);return{overviewWidget:buildOverviewWidget(n),horseTypesWidget:buildHorseTypesWidget(n)}}function processClientData(e){const t=new Set,n=[0,0],o=[0,0],i={},a={draft:0,horse:0,mule:0,donkey:0,mini_donkey:0,pony:0,mini_pony:0};return debugLog(),e.forEach((e=>{if(t.has(e.cID))return;t.add(e.cID);const s="yes"===e.active;n[+s]++;const r=e.horses||[],l=r.length;o[+s]+=l,i[l]||(i[l]=[]),i[l].push(e),r.forEach((e=>{const t=e.horse_type?.toLowerCase()||"horse";a.hasOwnProperty(t)?a[t]++:a.horse++}))})),debugLog(),debugLog(),debugLog(),debugLog(),{clientsByHorseCount:i,horseTypes:a,totalActiveClients:n[1],totalInactiveClients:n[0],totalActiveHorses:o[1],totalInactiveHorses:o[0],totalClients:n[0]+n[1],totalHorses:o[0]+o[1]}}function buildNoClientsComponent(){return buildEle({type:"div",myClass:["w3-padding-small","w3-center"],text:"No Clients Found"})}function renderNoClientPage({tabContainer:e,pageComponent:t}){const n=getValidElement(e);n.innerHTML="",n.appendChild(t)}function renderPage({tabContainer:e,pageComponent:t,widgets:n}){const o=getValidElement(e),{container:i,...a}=t;a.overviewContainer.appendChild(n.overviewWidget),a.horseTypesContainer.appendChild(n.horseTypesWidget),i.append(...Object.values(a)),o.innerHTML="",o.appendChild(i)}